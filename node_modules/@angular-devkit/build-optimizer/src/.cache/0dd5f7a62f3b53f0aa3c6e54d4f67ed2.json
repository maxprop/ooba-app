{"remainingRequest":"/Users/scottjoscelyne/Desktop/oasis/node_modules/@angular-devkit/build-optimizer/src/build-optimizer/webpack-loader.js??ref--8-1!/Users/scottjoscelyne/Desktop/oasis/node_modules/formiojs/WebformBuilder.js","dependencies":[{"path":"/Users/scottjoscelyne/Desktop/oasis/node_modules/formiojs/WebformBuilder.js","mtime":1584368630964},{"path":"/Users/scottjoscelyne/Desktop/oasis/node_modules/cache-loader/dist/cjs.js","mtime":1571276078087},{"path":"/Users/scottjoscelyne/Desktop/oasis/node_modules/@angular-devkit/build-optimizer/src/build-optimizer/webpack-loader.js","mtime":1571276072802}],"contextDependencies":[],"result":["\"use strict\";\n\nrequire(\"core-js/modules/es.symbol\");\n\nrequire(\"core-js/modules/es.symbol.description\");\n\nrequire(\"core-js/modules/es.symbol.iterator\");\n\nrequire(\"core-js/modules/es.array.concat\");\n\nrequire(\"core-js/modules/es.array.filter\");\n\nrequire(\"core-js/modules/es.array.find-index\");\n\nrequire(\"core-js/modules/es.array.iterator\");\n\nrequire(\"core-js/modules/es.array.map\");\n\nrequire(\"core-js/modules/es.function.name\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/es.object.get-prototype-of\");\n\nrequire(\"core-js/modules/es.object.keys\");\n\nrequire(\"core-js/modules/es.object.to-string\");\n\nrequire(\"core-js/modules/es.reflect.get\");\n\nrequire(\"core-js/modules/es.string.iterator\");\n\nrequire(\"core-js/modules/es.string.replace\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _Webform2 = _interopRequireDefault(require(\"./Webform\"));\n\nvar _dragula = _interopRequireDefault(require(\"dragula/dist/dragula\"));\n\nvar _tooltip = _interopRequireDefault(require(\"tooltip.js\"));\n\nvar _Components = _interopRequireDefault(require(\"./components/Components\"));\n\nvar _builder = _interopRequireDefault(require(\"./utils/builder\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _EventEmitter = _interopRequireDefault(require(\"./EventEmitter\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nrequire('./components/builder');\n\nvar WebformBuilder =\n/*#__PURE__*/\nfunction (_Webform) {\n  _inherits(WebformBuilder, _Webform);\n\n  function WebformBuilder(element, options) {\n    var _this;\n\n    _classCallCheck(this, WebformBuilder);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(WebformBuilder).call(this, element, options));\n    _this.builderHeight = 0;\n    _this.dragContainers = [];\n    _this.sidebarContainers = [];\n    _this.updateDraggable = _lodash.default.debounce(_this.refreshDraggable.bind(_assertThisInitialized(_this)), 200); // Setup the builder options.\n\n    _this.options.builder = _lodash.default.defaultsDeep({}, _this.options.builder, _this.defaultComponents);\n    _this.options.enableButtons = _lodash.default.defaults({}, _this.options.enableButtons, {\n      remove: true,\n      copy: true,\n      paste: true,\n      edit: true,\n      editJson: false\n    }); // Turn off if explicitely said to do so...\n\n    _lodash.default.each(_this.defaultComponents, function (config, key) {\n      if (config === false) {\n        _this.options.builder[key] = false;\n      }\n    });\n\n    _this.builderReady = new _nativePromiseOnly.default(function (resolve) {\n      _this.builderReadyResolve = resolve;\n    });\n    _this.groups = {};\n    _this.options.sideBarScroll = _lodash.default.get(_this.options, 'sideBarScroll', true);\n    _this.options.sideBarScrollOffset = _lodash.default.get(_this.options, 'sideBarScrollOffset', 0);\n    _this.options.hooks = _this.options.hooks || {};\n\n    _this.options.hooks.addComponents = function (components, parent) {\n      if (!components || !components.length && !components.nodrop) {\n        // Return a simple alert so they know they can add something here.\n        return [{\n          type: 'htmlelement',\n          internal: true,\n          tag: 'div',\n          className: 'drag-and-drop-alert alert alert-info',\n          attrs: [{\n            attr: 'id',\n            value: \"\".concat(parent.id, \"-placeholder\")\n          }, {\n            attr: 'style',\n            value: 'text-align:center;'\n          }, {\n            attr: 'role',\n            value: 'alert'\n          }],\n          content: _this.t('Drag and Drop a form component')\n        }];\n      }\n\n      return components;\n    };\n\n    _this.options.hooks.addComponent = function (container, comp, parent) {\n      if (!comp || !comp.component) {\n        return container;\n      }\n\n      if (!comp.noEdit && !comp.component.internal) {\n        // Make sure the component position is relative so the buttons align properly.\n        comp.getElement().style.position = 'relative';\n\n        var removeButton = _this.ce('div', {\n          class: 'btn btn-xxs btn-danger component-settings-button component-settings-button-remove'\n        }, _this.getIcon('remove'));\n\n        _this.addEventListener(removeButton, 'click', function () {\n          return _this.deleteComponent(comp);\n        });\n\n        new _tooltip.default(removeButton, {\n          trigger: 'hover',\n          placement: 'top',\n          title: _this.t('Remove')\n        });\n\n        var editButton = _this.ce('div', {\n          class: 'btn btn-xxs btn-default component-settings-button component-settings-button-edit'\n        }, _this.getIcon('cog'));\n\n        _this.addEventListener(editButton, 'click', function () {\n          return _this.editComponent(comp);\n        });\n\n        new _tooltip.default(editButton, {\n          trigger: 'hover',\n          placement: 'top',\n          title: _this.t('Edit')\n        });\n\n        var copyButton = _this.ce('div', {\n          class: 'btn btn-xxs btn-default component-settings-button component-settings-button-copy'\n        }, _this.getIcon('copy'));\n\n        _this.addEventListener(copyButton, 'click', function () {\n          return _this.copyComponent(comp);\n        });\n\n        new _tooltip.default(copyButton, {\n          trigger: 'hover',\n          placement: 'top',\n          title: _this.t('Copy')\n        });\n\n        var pasteButton = _this.ce('div', {\n          class: 'btn btn-xxs btn-default component-settings-button component-settings-button-paste'\n        }, _this.getIcon('save'));\n\n        var pasteTooltip = new _tooltip.default(pasteButton, {\n          trigger: 'hover',\n          placement: 'top',\n          title: _this.t('Paste below')\n        });\n\n        _this.addEventListener(pasteButton, 'click', function () {\n          pasteTooltip.hide();\n\n          _this.pasteComponent(comp);\n        });\n\n        var editJsonButton = _this.ce('div', {\n          class: 'btn btn-xxs btn-default component-settings-button component-settings-button-edit-json'\n        }, _this.getIcon('wrench'));\n\n        _this.addEventListener(editJsonButton, 'click', function () {\n          return _this.editComponent(comp, true);\n        });\n\n        new _tooltip.default(editJsonButton, {\n          trigger: 'hover',\n          placement: 'top',\n          title: _this.t('Edit JSON')\n        }); // Set in paste mode if we have an item in our clipboard.\n\n        if (window.sessionStorage) {\n          var data = window.sessionStorage.getItem('formio.clipboard');\n\n          if (data) {\n            _this.addClass(_this.element, 'builder-paste-mode');\n          }\n        } // Add the edit buttons to the component.\n\n\n        comp.prepend(_this.ce('div', {\n          class: 'component-btn-group'\n        }, [_this.options.enableButtons.remove ? removeButton : null, _this.options.enableButtons.copy ? copyButton : null, _this.options.enableButtons.paste ? pasteButton : null, _this.options.enableButtons.editJson ? editJsonButton : null, _this.options.enableButtons.edit ? editButton : null]));\n      }\n\n      if (!container.noDrop) {\n        _this.addDragContainer(container, parent);\n      }\n\n      return container;\n    };\n\n    _this.setBuilderElement();\n\n    return _this;\n  }\n\n  _createClass(WebformBuilder, [{\n    key: \"scrollSidebar\",\n    value: function scrollSidebar() {\n      var newTop = window.scrollY - this.sideBarTop + this.options.sideBarScrollOffset;\n      var shouldScroll = newTop > 0;\n\n      if (shouldScroll && newTop + this.sideBarElement.offsetHeight < this.builderHeight) {\n        this.sideBarElement.style.marginTop = \"\".concat(newTop, \"px\");\n      } else if (shouldScroll && this.sideBarElement.offsetHeight < this.builderHeight) {\n        this.sideBarElement.style.marginTop = \"\".concat(this.builderHeight - this.sideBarElement.offsetHeight, \"px\");\n      } else {\n        this.sideBarElement.style.marginTop = '0px';\n      }\n    }\n  }, {\n    key: \"setBuilderElement\",\n    value: function setBuilderElement() {\n      var _this2 = this;\n\n      return this.onElement.then(function () {\n        _this2.addClass(_this2.wrapper, 'row formbuilder');\n\n        _this2.builderSidebar = _this2.ce('div', {\n          class: 'col-xs-4 col-sm-3 col-md-2 formcomponents'\n        });\n\n        _this2.prependTo(_this2.builderSidebar, _this2.wrapper);\n\n        _this2.addClass(_this2.element, 'col-xs-8 col-sm-9 col-md-10 formarea');\n\n        _this2.element.component = _this2;\n      });\n    }\n  }, {\n    key: \"setForm\",\n    value: function setForm(form) {\n      var _this3 = this;\n\n      //populate isEnabled for recaptcha form settings\n      var isRecaptchaEnabled = false;\n\n      if (form.components) {\n        (0, _utils.eachComponent)(form.components, function (component) {\n          if (isRecaptchaEnabled) {\n            return;\n          }\n\n          if (component.type === 'recaptcha') {\n            isRecaptchaEnabled = true;\n            return false;\n          }\n        });\n\n        if (isRecaptchaEnabled) {\n          _lodash.default.set(form, 'settings.recaptcha.isEnabled', true);\n        } else if (_lodash.default.get(form, 'settings.recaptcha.isEnabled')) {\n          _lodash.default.set(form, 'settings.recaptcha.isEnabled', false);\n        }\n      }\n\n      this.emit('change', form);\n      return _get(_getPrototypeOf(WebformBuilder.prototype), \"setForm\", this).call(this, form).then(function (retVal) {\n        setTimeout(function () {\n          return _this3.builderHeight = _this3.element.offsetHeight;\n        }, 200);\n        return retVal;\n      });\n    }\n  }, {\n    key: \"deleteComponent\",\n    value: function deleteComponent(component) {\n      if (!component.parent) {\n        return;\n      }\n\n      var remove = true;\n\n      if (typeof component.getComponents === 'function' && component.getComponents().length > 0) {\n        var message = 'Removing this component will also remove all of its children. Are you sure you want to do this?';\n        remove = window.confirm(this.t(message));\n      }\n\n      if (remove) {\n        component.parent.removeComponentById(component.id);\n        this.form = this.schema;\n        this.emit('deleteComponent', component);\n      }\n\n      return remove;\n    }\n  }, {\n    key: \"updateComponent\",\n    value: function updateComponent(component) {\n      var _this4 = this;\n\n      // Update the preview.\n      if (this.componentPreview) {\n        if (this.preview) {\n          this.preview.destroy();\n        }\n\n        this.preview = _Components.default.create(component.component, {\n          preview: true,\n          events: new _EventEmitter.default({\n            wildcard: false,\n            maxListeners: 0\n          })\n        }, {}, true);\n        this.preview.on('componentEdit', function (comp) {\n          _lodash.default.merge(component.component, comp.component);\n\n          _this4.editForm.redraw();\n        });\n        this.preview.build();\n        this.preview.isBuilt = true;\n        this.componentPreview.innerHTML = '';\n        this.componentPreview.appendChild(this.preview.getElement());\n      } // Ensure this component has a key.\n\n\n      if (component.isNew) {\n        if (!component.keyModified) {\n          component.component.key = _lodash.default.camelCase(component.component.label || component.component.placeholder || component.component.type);\n        } // Set a unique key for this component.\n\n\n        _builder.default.uniquify(this._form, component.component);\n      } // Change the \"default value\" field to be reflective of this component.\n\n\n      if (this.defaultValueComponent) {\n        _lodash.default.assign(this.defaultValueComponent, _lodash.default.omit(component.component, ['key', 'label', 'placeholder', 'tooltip', 'validate', 'disabled', 'fields.day.required', 'fields.month.required', 'fields.year.required']));\n      } // Called when we update a component.\n\n\n      this.emit('updateComponent', component);\n    }\n    /* eslint-disable max-statements */\n\n  }, {\n    key: \"editComponent\",\n    value: function editComponent(component, isJsonEdit) {\n      var _this5 = this;\n\n      var componentCopy = _lodash.default.cloneDeep(component);\n\n      var componentClass = _Components.default.components[componentCopy.component.type];\n      var isCustom = componentClass === undefined; //custom component should be edited as JSON\n\n      isJsonEdit = isJsonEdit || isCustom;\n      componentClass = isCustom ? _Components.default.components.unknown : componentClass; // Make sure we only have one dialog open at a time.\n\n      if (this.dialog) {\n        this.dialog.close();\n      }\n\n      this.dialog = this.createModal(componentCopy.name);\n      var formioForm = this.ce('div');\n      this.componentPreview = this.ce('div', {\n        class: 'component-preview'\n      });\n      var componentInfo = componentClass ? componentClass.builderInfo : {};\n      var saveButton = this.ce('button', {\n        class: 'btn btn-success',\n        style: 'margin-right: 10px;'\n      }, this.t('Save'));\n      var cancelButton = this.ce('button', {\n        class: 'btn btn-default',\n        style: 'margin-right: 10px;'\n      }, this.t('Cancel'));\n      var removeButton = this.ce('button', {\n        class: 'btn btn-danger'\n      }, this.t('Remove'));\n      var componentEdit = this.ce('div', {}, [this.ce('div', {\n        class: 'row'\n      }, [this.ce('div', {\n        class: 'col col-sm-6'\n      }, this.ce('p', {\n        class: 'lead'\n      }, \"\".concat(this.t(componentInfo.title), \" \").concat(this.t('Component')))), this.ce('div', {\n        class: 'col col-sm-6'\n      }, [this.ce('div', {\n        class: 'pull-right',\n        style: 'margin-right: 20px; margin-top: 10px'\n      }, this.ce('a', {\n        href: componentInfo.documentation || '#',\n        target: '_blank'\n      }, this.ce('i', {\n        class: this.iconClass('new-window')\n      }, \" \".concat(this.t('Help')))))])]), this.ce('div', {\n        class: 'row'\n      }, [this.ce('div', {\n        class: 'col col-sm-6'\n      }, formioForm), this.ce('div', {\n        class: 'col col-sm-6'\n      }, [this.ce('div', {\n        class: 'card panel panel-default preview-panel'\n      }, [this.ce('div', {\n        class: 'card-header panel-heading'\n      }, this.ce('h4', {\n        class: 'card-title panel-title mb-0'\n      }, this.t('Preview'))), this.ce('div', {\n        class: 'card-body panel-body'\n      }, this.componentPreview)]), this.ce('div', {\n        style: 'margin-top: 10px;'\n      }, [saveButton, cancelButton, removeButton])])])]); // Append the settings page to the dialog body.\n\n      this.dialog.body.appendChild(componentEdit); // Allow editForm overrides per component.\n\n      var overrides = _lodash.default.get(this.options, \"editForm.\".concat(componentCopy.component.type), {}); // Get the editform for this component.\n\n\n      var editForm; //custom component has its own Edit Form defined\n\n      if (isJsonEdit && !isCustom) {\n        editForm = {\n          'components': [{\n            'type': 'textarea',\n            'as': 'json',\n            'editor': 'ace',\n            'weight': 10,\n            'input': true,\n            'key': 'componentJson',\n            'label': 'Component JSON',\n            'tooltip': 'Edit the JSON for this component.'\n          }]\n        };\n      } else {\n        editForm = componentClass.editForm(_lodash.default.cloneDeep(overrides));\n      } // Change the defaultValue component to be reflective.\n\n\n      this.defaultValueComponent = (0, _utils.getComponent)(editForm.components, 'defaultValue');\n\n      _lodash.default.assign(this.defaultValueComponent, _lodash.default.omit(componentCopy.component, ['key', 'label', 'placeholder', 'tooltip', 'validate', 'disabled', 'fields.day.required', 'fields.month.required', 'fields.year.required'])); // Create the form instance.\n\n\n      var editFormOptions = _lodash.default.get(this, 'options.editForm', {});\n\n      this.editForm = new _Webform2.default(formioForm, _objectSpread({\n        language: this.options.language\n      }, editFormOptions)); // Set the form to the edit form.\n\n      this.editForm.form = editForm; // Pass along the form being edited.\n\n      this.editForm.editForm = this._form;\n      this.editForm.editComponent = component; // Update the preview with this component.\n\n      this.updateComponent(componentCopy); // Register for when the edit form changes.\n\n      this.editForm.on('change', function (event) {\n        if (event.changed) {\n          // See if this is a manually modified key. Treat JSON edited component keys as manually modified\n          if (event.changed.component && event.changed.component.key === 'key' || isJsonEdit) {\n            componentCopy.keyModified = true;\n          } // Set the component JSON to the new data.\n\n\n          var editFormData = _this5.editForm.getValue().data; //for custom component use value in 'componentJson' field as JSON of component\n\n\n          if ((editFormData.type === 'custom' || isJsonEdit) && editFormData.componentJson) {\n            componentCopy.component = editFormData.componentJson;\n          } else {\n            componentCopy.component = editFormData;\n          } // Update the component.\n\n\n          _this5.updateComponent(componentCopy);\n        }\n      }); // Modify the component information in the edit form.\n\n      this.editForm.formReady.then(function () {\n        //for custom component populate component setting with component JSON\n        if (isJsonEdit) {\n          _this5.editForm.setValue({\n            data: {\n              componentJson: _lodash.default.cloneDeep(componentCopy.component)\n            }\n          });\n        } else {\n          _this5.editForm.setValue({\n            data: componentCopy.component\n          });\n        }\n      });\n      this.addEventListener(cancelButton, 'click', function (event) {\n        event.preventDefault();\n\n        _this5.emit('cancelComponent', component);\n\n        _this5.dialog.close();\n      });\n      this.addEventListener(removeButton, 'click', function (event) {\n        event.preventDefault();\n\n        _this5.deleteComponent(component);\n\n        _this5.dialog.close();\n      });\n      this.addEventListener(saveButton, 'click', function (event) {\n        if (!_this5.editForm.checkValidity(_this5.editForm.data, true)) {\n          return;\n        }\n\n        event.preventDefault();\n        var originalComponent = component.schema;\n        component.isNew = false; //for JSON Edit use value in 'componentJson' field as JSON of component\n\n        if (isJsonEdit) {\n          component.component = _this5.editForm.data.componentJson;\n        } else {\n          component.component = componentCopy.component;\n        }\n\n        if (component.dragEvents && component.dragEvents.onSave) {\n          component.dragEvents.onSave(component);\n        }\n\n        _this5.form = _this5.schema;\n\n        _this5.emit('saveComponent', component, originalComponent);\n\n        _this5.dialog.close();\n      });\n      this.addEventListener(this.dialog, 'close', function () {\n        _this5.editForm.destroy(true);\n\n        _this5.preview.destroy(true);\n\n        if (component.isNew) {\n          _this5.deleteComponent(component);\n        }\n      }); // Called when we edit a component.\n\n      this.emit('editComponent', component);\n    }\n    /* eslint-enable max-statements */\n\n    /**\n     * Creates copy of component schema and stores it under sessionStorage.\n     * @param {Component} component\n     * @return {*}\n     */\n\n  }, {\n    key: \"copyComponent\",\n    value: function copyComponent(component) {\n      if (!window.sessionStorage) {\n        return console.log('Session storage is not supported in this browser.');\n      }\n\n      this.addClass(this.element, 'builder-paste-mode');\n\n      var copy = _lodash.default.cloneDeep(component.schema);\n\n      window.sessionStorage.setItem('formio.clipboard', JSON.stringify(copy));\n    }\n    /**\n     * Paste copied component after the current component.\n     * @param {Component} component\n     * @return {*}\n     */\n\n  }, {\n    key: \"pasteComponent\",\n    value: function pasteComponent(component) {\n      if (!window.sessionStorage) {\n        return console.log('Session storage is not supported in this browser.');\n      }\n\n      this.removeClass(this.element, 'builder-paste-mode');\n      var data = window.sessionStorage.getItem('formio.clipboard');\n\n      if (data) {\n        var schema = JSON.parse(data);\n        window.sessionStorage.removeItem('formio.clipboard');\n\n        _builder.default.uniquify(this._form, schema); // If this is an empty \"nested\" component, and it is empty, then paste the component inside this component.\n\n\n        if (typeof component.addComponent === 'function' && !component.components.length) {\n          component.addComponent(schema);\n        } else {\n          component.parent.addComponent(schema, false, false, component.element.nextSibling);\n        }\n\n        this.form = this.schema;\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var state = _get(_getPrototypeOf(WebformBuilder.prototype), \"destroy\", this).call(this);\n\n      if (this.dragula) {\n        this.dragula.destroy();\n      }\n\n      return state;\n    }\n    /**\n     * Insert an element in the weight order.\n     *\n     * @param info\n     * @param items\n     * @param element\n     * @param container\n     */\n\n  }, {\n    key: \"insertInOrder\",\n    value: function insertInOrder(info, items, element, container) {\n      // Determine where this item should be added.\n      var beforeWeight = 0;\n      var before = null;\n\n      _lodash.default.each(items, function (itemInfo) {\n        if (info.key !== itemInfo.key && info.weight < itemInfo.weight && (!beforeWeight || itemInfo.weight < beforeWeight)) {\n          before = itemInfo.element;\n          beforeWeight = itemInfo.weight;\n        }\n      });\n\n      if (before) {\n        try {\n          container.insertBefore(element, before);\n        } catch (err) {\n          container.appendChild(element);\n        }\n      } else {\n        container.appendChild(element);\n      }\n    }\n  }, {\n    key: \"addBuilderGroup\",\n    value: function addBuilderGroup(info, container) {\n      var _this6 = this;\n\n      if (!info || !info.key) {\n        console.warn('Invalid Group Provided.');\n        return;\n      }\n\n      info = _lodash.default.clone(info);\n      var groupAnchor = this.ce('button', {\n        class: 'btn btn-block builder-group-button',\n        'type': 'button',\n        'data-toggle': 'collapse',\n        'data-parent': \"#\".concat(container.id),\n        'data-target': \"#group-\".concat(info.key)\n      }, this.text(info.title)); // Add a listener when it is clicked.\n\n      if (!(0, _utils.bootstrapVersion)(this.options)) {\n        this.addEventListener(groupAnchor, 'click', function (event) {\n          event.preventDefault();\n          var clickedGroupId = event.target.getAttribute('data-target').replace('#group-', '');\n\n          if (_this6.groups[clickedGroupId]) {\n            var clickedGroup = _this6.groups[clickedGroupId];\n\n            var wasIn = _this6.hasClass(clickedGroup.panel, 'in');\n\n            _lodash.default.each(_this6.groups, function (group, groupId) {\n              _this6.removeClass(group.panel, 'in');\n\n              _this6.removeClass(group.panel, 'show');\n\n              if (groupId === clickedGroupId && !wasIn) {\n                _this6.addClass(group.panel, 'in');\n\n                _this6.addClass(group.panel, 'show');\n\n                var parent = group.parent;\n\n                while (parent) {\n                  _this6.addClass(parent.panel, 'in');\n\n                  _this6.addClass(parent.panel, 'show');\n\n                  parent = parent.parent;\n                }\n              }\n            }); // Match the form builder height to the sidebar.\n\n\n            _this6.element.style.minHeight = \"\".concat(_this6.builderSidebar.offsetHeight, \"px\");\n\n            _this6.scrollSidebar();\n          }\n        }, true);\n      }\n\n      info.element = this.ce('div', {\n        class: 'card panel panel-default form-builder-panel',\n        id: \"group-panel-\".concat(info.key)\n      }, [this.ce('div', {\n        class: 'card-header panel-heading form-builder-group-header'\n      }, [this.ce('h5', {\n        class: 'mb-0 panel-title'\n      }, groupAnchor)])]);\n      info.body = this.ce('div', {\n        id: \"group-container-\".concat(info.key),\n        class: 'card-body panel-body no-drop'\n      }); // Add this group body to the drag containers.\n\n      this.sidebarContainers.push(info.body);\n      var groupBodyClass = 'panel-collapse collapse';\n\n      if (info.default) {\n        switch ((0, _utils.bootstrapVersion)(this.options)) {\n          case 4:\n            groupBodyClass += ' show';\n            break;\n\n          case 3:\n            groupBodyClass += ' in';\n            break;\n\n          default:\n            groupBodyClass += ' in show';\n            break;\n        }\n      }\n\n      info.panel = this.ce('div', {\n        class: groupBodyClass,\n        'data-parent': \"#\".concat(container.id),\n        id: \"group-\".concat(info.key)\n      }, info.body);\n      info.element.appendChild(info.panel);\n      this.groups[info.key] = info;\n      this.insertInOrder(info, this.groups, info.element, container); // Now see if this group has subgroups.\n\n      if (info.groups) {\n        _lodash.default.each(info.groups, function (subInfo, subGroup) {\n          subInfo.key = subGroup;\n          subInfo.parent = info;\n\n          _this6.addBuilderGroup(subInfo, info.body);\n        });\n      }\n    }\n  }, {\n    key: \"addBuilderComponentInfo\",\n    value: function addBuilderComponentInfo(component) {\n      if (!component || !component.group || !this.groups[component.group]) {\n        return;\n      }\n\n      component = _lodash.default.clone(component);\n      var groupInfo = this.groups[component.group];\n\n      if (!groupInfo.components) {\n        groupInfo.components = {};\n      }\n\n      if (!groupInfo.components.hasOwnProperty(component.key)) {\n        groupInfo.components[component.key] = component;\n      }\n\n      return component;\n    }\n  }, {\n    key: \"addBuilderComponent\",\n    value: function addBuilderComponent(component, group) {\n      if (!component) {\n        return;\n      }\n\n      if (!group && component.group && this.groups[component.group]) {\n        group = this.groups[component.group];\n      }\n\n      if (!group) {\n        return;\n      }\n\n      component.element = this.ce('span', {\n        id: \"builder-\".concat(component.key),\n        class: 'btn btn-primary btn-xs btn-block formcomponent drag-copy'\n      });\n\n      if (component.icon) {\n        component.element.appendChild(this.ce('i', {\n          class: component.icon,\n          style: 'margin-right: 5px;'\n        }));\n      }\n\n      component.element.builderInfo = component;\n      component.element.appendChild(this.text(component.title));\n      this.insertInOrder(component, group.components, component.element, group.body);\n      return component;\n    }\n  }, {\n    key: \"addBuilderButton\",\n    value: function addBuilderButton(info, container) {\n      var _this7 = this;\n\n      var button;\n      info.element = this.ce('div', {\n        style: 'margin: 5px 0;'\n      }, button = this.ce('span', {\n        class: \"btn btn-block \".concat(info.style || 'btn-default')\n      }, info.title)); // Make sure it persists across refreshes.\n\n      this.addEventListener(button, 'click', function () {\n        return _this7.emit(info.event);\n      }, true);\n      this.groups[info.key] = info;\n      this.insertInOrder(info, this.groups, info.element, container);\n    }\n  }, {\n    key: \"buildSidebar\",\n    value: function buildSidebar() {\n      var _this8 = this;\n\n      // Do not rebuild the sidebar.\n      if (this.sideBarElement) {\n        return;\n      }\n\n      this.groups = {};\n      this.sidebarContainers = [];\n      this.sideBarElement = this.ce('div', {\n        id: \"builder-sidebar-\".concat(this.id),\n        class: 'accordion panel-group'\n      }); // Add the groups.\n\n      _lodash.default.each(this.options.builder, function (info, group) {\n        if (info) {\n          info.key = group;\n\n          if (info.type === 'button') {\n            _this8.addBuilderButton(info, _this8.sideBarElement);\n          } else {\n            _this8.addBuilderGroup(info, _this8.sideBarElement);\n          }\n        }\n      }); // Get all of the components builder info grouped and sorted.\n\n\n      var components = {};\n\n      var allComponents = _lodash.default.filter(_lodash.default.map(_Components.default.components, function (component, type) {\n        if (!component.builderInfo) {\n          return null;\n        }\n\n        component.type = type;\n        return component;\n      }));\n\n      _lodash.default.map(_lodash.default.sortBy(allComponents, function (component) {\n        return component.builderInfo.weight;\n      }), function (component) {\n        var builderInfo = component.builderInfo;\n        builderInfo.key = component.type;\n        components[builderInfo.key] = builderInfo;\n\n        _this8.addBuilderComponentInfo(builderInfo);\n      }); // Add the components in each group.\n\n\n      _lodash.default.each(this.groups, function (info) {\n        return _lodash.default.each(info.components, function (comp, key) {\n          if (comp) {\n            _this8.addBuilderComponent(comp === true ? components[key] : comp, info);\n          }\n        });\n      }); // Add the new sidebar element.\n\n\n      this.builderSidebar.appendChild(this.sideBarElement);\n      this.updateDraggable();\n      this.sideBarTop = this.sideBarElement.getBoundingClientRect().top + window.scrollY;\n\n      if (this.options.sideBarScroll) {\n        this.addEventListener(window, 'scroll', _lodash.default.throttle(this.scrollSidebar.bind(this), 10), true);\n      }\n    }\n  }, {\n    key: \"getParentElement\",\n    value: function getParentElement(element) {\n      var containerComponent = element;\n\n      do {\n        containerComponent = containerComponent.parentNode;\n      } while (containerComponent && !containerComponent.component);\n\n      return containerComponent;\n    }\n  }, {\n    key: \"addDragContainer\",\n    value: function addDragContainer(element, component, dragEvents) {\n      _lodash.default.remove(this.dragContainers, function (container) {\n        return element.id && element.id === container.id;\n      });\n\n      element.component = component;\n\n      if (dragEvents) {\n        element.dragEvents = dragEvents;\n      }\n\n      this.addClass(element, 'drag-container');\n\n      if (!element.id) {\n        element.id = \"builder-element-\".concat(component.id);\n      }\n\n      this.dragContainers.push(element);\n      this.updateDraggable();\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.dragContainers = [];\n      return _get(_getPrototypeOf(WebformBuilder.prototype), \"clear\", this).call(this);\n    }\n  }, {\n    key: \"addComponentTo\",\n    value: function addComponentTo(schema, parent, element, sibling, after) {\n      var component = parent.addComponent(schema, element, parent.data, sibling);\n\n      if (after) {\n        after(component);\n      } // Get path to the component in the parent component.\n\n\n      var path = 'components';\n\n      switch (component.parent.type) {\n        case 'table':\n          path = \"rows[\".concat(component.tableRow, \"][\").concat(component.tableColumn, \"].components\");\n          break;\n\n        case 'columns':\n          path = \"columns[\".concat(component.column, \"].components\");\n          break;\n\n        case 'tabs':\n          path = \"components[\".concat(component.tab, \"].components\");\n          break;\n      } // Index within container\n\n\n      var index = _lodash.default.findIndex(_lodash.default.get(component.parent.schema, path), {\n        key: component.component.key\n      }) || 0;\n      this.emit('addComponent', component, path, index);\n      return component;\n    }\n    /* eslint-disable  max-statements */\n\n  }, {\n    key: \"onDrop\",\n    value: function onDrop(element, target, source, sibling) {\n      if (!element || !element.id) {\n        console.warn('No element.id defined for dropping');\n        return;\n      }\n\n      var builderElement = source.querySelector(\"#\".concat(element.id));\n      var newParent = this.getParentElement(element);\n\n      if (!newParent || !newParent.component) {\n        return console.warn('Could not find parent component.');\n      } // Remove any instances of the placeholder.\n\n\n      var placeholder = document.getElementById(\"\".concat(newParent.component.id, \"-placeholder\"));\n\n      if (placeholder) {\n        placeholder = placeholder.parentNode;\n        placeholder.parentNode.removeChild(placeholder);\n      } // If the sibling is the placeholder, then set it to null.\n\n\n      if (sibling === placeholder) {\n        sibling = null;\n      } // Make this element go before the submit button if it is still on the builder.\n\n\n      if (!sibling && this.submitButton && newParent.contains(this.submitButton.element)) {\n        sibling = this.submitButton.element;\n      } // If this is a new component, it will come from the builderElement\n\n\n      if (builderElement && builderElement.builderInfo && builderElement.builderInfo.schema) {\n        var componentSchema = _lodash.default.clone(builderElement.builderInfo.schema);\n\n        if (target.dragEvents && target.dragEvents.onDrop) {\n          target.dragEvents.onDrop(element, target, source, sibling, componentSchema);\n        } // Add the new component.\n\n\n        var component = this.addComponentTo(componentSchema, newParent.component, newParent, sibling, function (comp) {\n          // Set that this is a new component.\n          comp.isNew = true; // Pass along the save event.\n\n          if (target.dragEvents) {\n            comp.dragEvents = target.dragEvents;\n          }\n        }); // Edit the component.\n\n        this.editComponent(component); // Remove the element.\n\n        target.removeChild(element);\n      } // Check to see if this is a moved component.\n      else if (element.component) {\n          var _componentSchema = element.component.schema;\n\n          if (target.dragEvents && target.dragEvents.onDrop) {\n            target.dragEvents.onDrop(element, target, source, sibling, _componentSchema);\n          } // Remove the component from its parent.\n\n\n          if (element.component.parent) {\n            this.emit('deleteComponent', element.component);\n            element.component.parent.removeComponent(element.component);\n          } // Add the new component.\n\n\n          var _component = this.addComponentTo(_componentSchema, newParent.component, newParent, sibling);\n\n          if (target.dragEvents && target.dragEvents.onSave) {\n            target.dragEvents.onSave(_component);\n          } // Refresh the form.\n\n\n          this.form = this.schema;\n        }\n    }\n    /* eslint-enable  max-statements */\n\n    /**\n     * Adds a submit button if there are no components.\n     */\n\n  }, {\n    key: \"addSubmitButton\",\n    value: function addSubmitButton() {\n      if (!this.getComponents().length) {\n        this.submitButton = this.addComponent({\n          type: 'button',\n          label: this.t('Submit'),\n          key: 'submit',\n          size: 'md',\n          block: false,\n          action: 'submit',\n          disableOnInvalid: true,\n          theme: 'primary'\n        });\n      }\n    }\n  }, {\n    key: \"refreshDraggable\",\n    value: function refreshDraggable() {\n      var _this9 = this;\n\n      if (this.dragula) {\n        this.dragula.destroy();\n      }\n\n      this.dragula = (0, _dragula.default)(this.sidebarContainers.concat(this.dragContainers), {\n        moves: function moves(el) {\n          return !el.classList.contains('no-drag');\n        },\n        copy: function copy(el) {\n          return el.classList.contains('drag-copy');\n        },\n        accepts: function accepts(el, target) {\n          return !el.contains(target) && !target.classList.contains('no-drop');\n        }\n      }).on('drop', function (element, target, source, sibling) {\n        return _this9.onDrop(element, target, source, sibling);\n      }); // If there are no components, then we need to add a default submit button.\n\n      this.addSubmitButton();\n      this.builderReadyResolve();\n    }\n  }, {\n    key: \"build\",\n    value: function build(state) {\n      this.buildSidebar();\n\n      _get(_getPrototypeOf(WebformBuilder.prototype), \"build\", this).call(this, state);\n\n      this.updateDraggable();\n      this.formReadyResolve();\n    }\n  }, {\n    key: \"defaultComponents\",\n    get: function get() {\n      return {\n        basic: {\n          title: 'Basic Components',\n          weight: 0,\n          default: true\n        },\n        advanced: {\n          title: 'Advanced',\n          weight: 10\n        },\n        layout: {\n          title: 'Layout',\n          weight: 20\n        },\n        data: {\n          title: 'Data',\n          weight: 30\n        }\n      };\n    }\n  }, {\n    key: \"ready\",\n    get: function get() {\n      return this.builderReady;\n    }\n  }]);\n\n  return WebformBuilder;\n}(_Webform2.default);\n\nexports.default = WebformBuilder;",null]}