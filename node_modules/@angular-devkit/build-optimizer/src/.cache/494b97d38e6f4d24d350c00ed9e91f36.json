{"remainingRequest":"/Users/scottjoscelyne/Desktop/oasis/node_modules/@angular-devkit/build-optimizer/src/build-optimizer/webpack-loader.js??ref--8-1!/Users/scottjoscelyne/Desktop/oasis/node_modules/formiojs/components/file/File.js","dependencies":[{"path":"/Users/scottjoscelyne/Desktop/oasis/node_modules/formiojs/components/file/File.js","mtime":1581861142273},{"path":"/Users/scottjoscelyne/Desktop/oasis/node_modules/cache-loader/dist/cjs.js","mtime":1571276078087},{"path":"/Users/scottjoscelyne/Desktop/oasis/node_modules/@angular-devkit/build-optimizer/src/build-optimizer/webpack-loader.js","mtime":1571276072802}],"contextDependencies":[],"result":["\"use strict\";\n\nrequire(\"core-js/modules/es.symbol\");\n\nrequire(\"core-js/modules/es.symbol.description\");\n\nrequire(\"core-js/modules/es.symbol.iterator\");\n\nrequire(\"core-js/modules/es.array.concat\");\n\nrequire(\"core-js/modules/es.array.iterator\");\n\nrequire(\"core-js/modules/es.array.join\");\n\nrequire(\"core-js/modules/es.array.map\");\n\nrequire(\"core-js/modules/es.array.slice\");\n\nrequire(\"core-js/modules/es.array.splice\");\n\nrequire(\"core-js/modules/es.function.name\");\n\nrequire(\"core-js/modules/es.number.to-fixed\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor\");\n\nrequire(\"core-js/modules/es.object.get-prototype-of\");\n\nrequire(\"core-js/modules/es.object.keys\");\n\nrequire(\"core-js/modules/es.object.to-string\");\n\nrequire(\"core-js/modules/es.reflect.get\");\n\nrequire(\"core-js/modules/es.regexp.constructor\");\n\nrequire(\"core-js/modules/es.regexp.to-string\");\n\nrequire(\"core-js/modules/es.string.iterator\");\n\nrequire(\"core-js/modules/es.string.replace\");\n\nrequire(\"core-js/modules/es.string.search\");\n\nrequire(\"core-js/modules/es.string.split\");\n\nrequire(\"core-js/modules/es.typed-array.uint8-array\");\n\nrequire(\"core-js/modules/es.typed-array.copy-within\");\n\nrequire(\"core-js/modules/es.typed-array.every\");\n\nrequire(\"core-js/modules/es.typed-array.fill\");\n\nrequire(\"core-js/modules/es.typed-array.filter\");\n\nrequire(\"core-js/modules/es.typed-array.find\");\n\nrequire(\"core-js/modules/es.typed-array.find-index\");\n\nrequire(\"core-js/modules/es.typed-array.for-each\");\n\nrequire(\"core-js/modules/es.typed-array.includes\");\n\nrequire(\"core-js/modules/es.typed-array.index-of\");\n\nrequire(\"core-js/modules/es.typed-array.iterator\");\n\nrequire(\"core-js/modules/es.typed-array.join\");\n\nrequire(\"core-js/modules/es.typed-array.last-index-of\");\n\nrequire(\"core-js/modules/es.typed-array.map\");\n\nrequire(\"core-js/modules/es.typed-array.reduce\");\n\nrequire(\"core-js/modules/es.typed-array.reduce-right\");\n\nrequire(\"core-js/modules/es.typed-array.reverse\");\n\nrequire(\"core-js/modules/es.typed-array.set\");\n\nrequire(\"core-js/modules/es.typed-array.slice\");\n\nrequire(\"core-js/modules/es.typed-array.some\");\n\nrequire(\"core-js/modules/es.typed-array.sort\");\n\nrequire(\"core-js/modules/es.typed-array.subarray\");\n\nrequire(\"core-js/modules/es.typed-array.to-locale-string\");\n\nrequire(\"core-js/modules/es.typed-array.to-string\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _Base = _interopRequireDefault(require(\"../base/Base\"));\n\nvar _utils = require(\"../../utils/utils\");\n\nvar _downloadjs = _interopRequireDefault(require(\"downloadjs\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _Formio = _interopRequireDefault(require(\"../../Formio\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\n// canvas.toBlob polyfill.\nif (!HTMLCanvasElement.prototype.toBlob) {\n  Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n    value: function value(callback, type, quality) {\n      var canvas = this;\n      setTimeout(function () {\n        var binStr = atob(canvas.toDataURL(type, quality).split(',')[1]),\n            len = binStr.length,\n            arr = new Uint8Array(len);\n\n        for (var i = 0; i < len; i++) {\n          arr[i] = binStr.charCodeAt(i);\n        }\n\n        callback(new Blob([arr], {\n          type: type || 'image/png'\n        }));\n      });\n    }\n  });\n}\n\nvar FileComponent =\n/*#__PURE__*/\nfunction (_BaseComponent) {\n  _inherits(FileComponent, _BaseComponent);\n\n  _createClass(FileComponent, null, [{\n    key: \"schema\",\n    value: function schema() {\n      for (var _len = arguments.length, extend = new Array(_len), _key = 0; _key < _len; _key++) {\n        extend[_key] = arguments[_key];\n      }\n\n      return _Base.default.schema.apply(_Base.default, [{\n        type: 'file',\n        label: 'Upload',\n        key: 'file',\n        image: false,\n        privateDownload: false,\n        imageSize: '200',\n        filePattern: '*',\n        fileMinSize: '0KB',\n        fileMaxSize: '1GB',\n        uploadOnly: false,\n        defaultOverlayWidth: 200,\n        defaultOverlayHeight: 200\n      }].concat(extend));\n    }\n  }, {\n    key: \"builderInfo\",\n    get: function get() {\n      return {\n        title: 'File',\n        group: 'advanced',\n        icon: 'fa fa-file',\n        documentation: 'http://help.form.io/userguide/#file',\n        weight: 100,\n        schema: FileComponent.schema()\n      };\n    }\n  }]);\n\n  function FileComponent(component, options, data) {\n    var _this;\n\n    _classCallCheck(this, FileComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FileComponent).call(this, component, options, data)); // Called when our files are ready.\n\n    _this.filesReady = new _nativePromiseOnly.default(function (resolve, reject) {\n      _this.filesReadyResolve = resolve;\n      _this.filesReadyReject = reject;\n    });\n    _this.loadingImages = [];\n    _this.support = {\n      filereader: typeof FileReader != 'undefined',\n      dnd: 'draggable' in document.createElement('span'),\n      formdata: !!window.FormData,\n      progress: 'upload' in new XMLHttpRequest()\n    };\n    return _this;\n  }\n\n  _createClass(FileComponent, [{\n    key: \"getValue\",\n    value: function getValue() {\n      return this.dataValue;\n    }\n  }, {\n    key: \"getView\",\n    value: function getView(value) {\n      if (_lodash.default.isArray(value)) {\n        return _lodash.default.map(value, 'originalName').join(', ');\n      }\n\n      return _lodash.default.get(value, 'originalName', '');\n    }\n  }, {\n    key: \"loadImage\",\n    value: function loadImage(fileInfo) {\n      return this.fileService.downloadFile(fileInfo).then(function (result) {\n        return result.url;\n      });\n    }\n  }, {\n    key: \"setValue\",\n    value: function setValue(value) {\n      var _this2 = this;\n\n      var newValue = value || [];\n      var changed = this.hasChanged(newValue, this.dataValue);\n      this.dataValue = newValue;\n\n      if (this.component.image) {\n        this.loadingImages = [];\n        var images = Array.isArray(newValue) ? newValue : [newValue];\n        images.map(function (fileInfo) {\n          if (fileInfo && Object.keys(fileInfo).length) {\n            _this2.loadingImages.push(_this2.loadImage(fileInfo));\n          }\n        });\n\n        if (this.loadingImages.length) {\n          _nativePromiseOnly.default.all(this.loadingImages).then(function () {\n            _this2.refreshDOM();\n\n            setTimeout(function () {\n              return _this2.filesReadyResolve();\n            }, 100);\n          }).catch(function () {\n            return _this2.filesReadyReject();\n          });\n        }\n      } else {\n        this.refreshDOM();\n        this.filesReadyResolve();\n      }\n\n      return changed;\n    }\n  }, {\n    key: \"validateMultiple\",\n    // File is always an array.\n    value: function validateMultiple() {\n      return false;\n    }\n  }, {\n    key: \"build\",\n    value: function build() {\n      // Restore the value.\n      this.restoreValue();\n      var labelAtTheBottom = this.component.labelPosition === 'bottom';\n      this.createElement();\n\n      if (!labelAtTheBottom) {\n        this.createLabel(this.element);\n      }\n\n      this.inputsContainer = this.ce('div');\n      this.errorContainer = this.inputsContainer;\n      this.createErrorElement();\n      this.listContainer = this.buildList();\n      this.inputsContainer.appendChild(this.listContainer);\n      this.uploadContainer = this.buildUpload();\n      this.hiddenFileInputElement = this.buildHiddenFileInput();\n      this.hook('input', this.hiddenFileInputElement, this.inputsContainer);\n      this.inputsContainer.appendChild(this.hiddenFileInputElement);\n      this.inputsContainer.appendChild(this.uploadContainer);\n      this.addWarnings(this.inputsContainer);\n      this.buildUploadStatusList(this.inputsContainer);\n      this.setInputStyles(this.inputsContainer);\n      this.element.appendChild(this.inputsContainer);\n\n      if (labelAtTheBottom) {\n        this.createLabel(this.element);\n      }\n\n      this.createDescription(this.element);\n      this.autofocus(); // Disable if needed.\n\n      if (this.shouldDisable) {\n        this.disabled = true;\n      }\n\n      this.attachLogic();\n    }\n  }, {\n    key: \"refreshDOM\",\n    value: function refreshDOM() {\n      // Don't refresh before the initial render.\n      if (this.listContainer && this.uploadContainer) {\n        // Refresh file list.\n        var newList = this.buildList();\n        this.inputsContainer.replaceChild(newList, this.listContainer);\n        this.listContainer = newList; // Refresh upload container.\n\n        var newUpload = this.buildUpload();\n        this.inputsContainer.replaceChild(newUpload, this.uploadContainer);\n        this.uploadContainer = newUpload;\n      }\n    }\n  }, {\n    key: \"buildList\",\n    value: function buildList() {\n      if (this.component.image) {\n        return this.buildImageList();\n      } else {\n        return this.buildFileList();\n      }\n    }\n  }, {\n    key: \"buildFileList\",\n    value: function buildFileList() {\n      var _this3 = this;\n\n      var value = this.dataValue;\n      return this.ce('ul', {\n        class: 'list-group list-group-striped'\n      }, [this.ce('li', {\n        class: 'list-group-item list-group-header hidden-xs hidden-sm'\n      }, this.ce('div', {\n        class: 'row'\n      }, [this.ce('div', {\n        class: 'col-md-1'\n      }), this.ce('div', {\n        class: \"col-md-\".concat(this.hasTypes ? '7' : '9')\n      }, this.ce('strong', {}, this.text('File Name'))), this.ce('div', {\n        class: 'col-md-2'\n      }, this.ce('strong', {}, this.text('Size'))), this.hasTypes ? this.ce('div', {\n        class: 'col-md-2'\n      }, this.ce('strong', {}, this.text('Type'))) : null])), Array.isArray(value) ? value.map(function (fileInfo, index) {\n        return _this3.createFileListItem(fileInfo, index);\n      }) : null]);\n    }\n  }, {\n    key: \"buildHiddenFileInput\",\n    value: function buildHiddenFileInput() {\n      var _this4 = this;\n\n      // Input needs to be in DOM and \"visible\" (opacity 0 is fine) for IE to display file dialog.\n      return this.ce('input', {\n        type: 'file',\n        style: 'opacity: 0; position: absolute;',\n        tabindex: -1,\n        // prevent focus\n        onChange: function onChange() {\n          _this4.upload(_this4.hiddenFileInputElement.files);\n\n          _this4.hiddenFileInputElement.value = '';\n        }\n      });\n    }\n  }, {\n    key: \"createFileListItem\",\n    value: function createFileListItem(fileInfo, index) {\n      var _this5 = this;\n\n      var fileService = this.fileService;\n      return this.ce('li', {\n        class: 'list-group-item'\n      }, this.ce('div', {\n        class: 'row'\n      }, [this.ce('div', {\n        class: 'col-md-1'\n      }, !this.disabled && !this.shouldDisable ? this.ce('i', {\n        class: this.iconClass('remove'),\n        onClick: function onClick(event) {\n          if (fileInfo && _this5.component.storage === 'url') {\n            fileService.makeRequest('', fileInfo.url, 'delete');\n          }\n\n          event.preventDefault();\n\n          _this5.splice(index);\n\n          _this5.refreshDOM();\n        }\n      }) : null), this.ce('div', {\n        class: \"col-md-\".concat(this.hasTypes ? '7' : '9')\n      }, this.createFileLink(fileInfo)), this.ce('div', {\n        class: 'col-md-2'\n      }, this.fileSize(fileInfo.size)), this.hasTypes ? this.ce('div', {\n        class: 'col-md-2'\n      }, this.createTypeSelect(fileInfo)) : null]));\n    }\n  }, {\n    key: \"createFileLink\",\n    value: function createFileLink(file) {\n      if (this.options.uploadOnly) {\n        return file.originalName || file.name;\n      }\n\n      return this.ce('a', {\n        href: file.url,\n        target: '_blank',\n        onClick: this.getFile.bind(this, file)\n      }, file.originalName || file.name);\n    }\n  }, {\n    key: \"createTypeSelect\",\n    value: function createTypeSelect(file) {\n      var _this6 = this;\n\n      return this.ce('select', {\n        class: 'file-type',\n        onChange: function onChange(event) {\n          file.fileType = event.target.value;\n\n          _this6.triggerChange();\n        }\n      }, this.component.fileTypes.map(function (type) {\n        return _this6.ce('option', {\n          value: type.value,\n          class: 'test',\n          selected: type.value === file.fileType ? 'selected' : undefined\n        }, type.label);\n      }));\n    }\n  }, {\n    key: \"buildImageList\",\n    value: function buildImageList() {\n      var _this7 = this;\n\n      var value = this.dataValue;\n      return this.ce('div', {}, Array.isArray(value) ? value.map(function (fileInfo, index) {\n        return _this7.createImageListItem(fileInfo, index);\n      }) : null);\n    }\n  }, {\n    key: \"createImageListItem\",\n    value: function createImageListItem(fileInfo, index) {\n      var _this8 = this;\n\n      var image = this.ce('img', {\n        alt: fileInfo.originalName || fileInfo.name,\n        style: \"width:\".concat(this.component.imageSize, \"px\")\n      });\n\n      if (this.loadingImages[index]) {\n        this.loadingImages[index].then(function (url) {\n          image.src = url;\n        });\n      }\n\n      return this.ce('div', {}, this.ce('span', {}, [image, !this.disabled ? this.ce('i', {\n        class: this.iconClass('remove'),\n        onClick: function onClick(event) {\n          if (fileInfo && _this8.component.storage === 'url') {\n            _this8.fileService.makeRequest('', fileInfo.url, 'delete');\n          }\n\n          event.preventDefault();\n\n          _this8.splice(index);\n\n          _this8.refreshDOM();\n        }\n      }) : null]));\n    }\n  }, {\n    key: \"startVideo\",\n    value: function startVideo() {\n      var _this9 = this;\n\n      navigator.getMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n      navigator.getMedia({\n        video: {\n          width: {\n            min: 640,\n            ideal: 1920\n          },\n          height: {\n            min: 400,\n            ideal: 1080\n          },\n          aspectRatio: {\n            ideal: 1.7777777778\n          }\n        },\n        audio: false\n      }, function (stream) {\n        if (navigator.mozGetUserMedia) {\n          _this9.video.mozSrcObject = stream;\n        } else {\n          _this9.video.srcObject = stream;\n        }\n\n        var width = parseInt(_this9.component.webcamSize) || 320;\n\n        _this9.video.setAttribute('width', width);\n\n        _this9.video.play();\n      }, function (err) {\n        console.log(err);\n      });\n    }\n  }, {\n    key: \"takePicture\",\n    value: function takePicture() {\n      var _this10 = this;\n\n      this.canvas.setAttribute('width', this.video.videoWidth);\n      this.canvas.setAttribute('height', this.video.videoHeight);\n      this.canvas.getContext('2d').drawImage(this.video, 0, 0);\n      this.canvas.toBlob(function (blob) {\n        blob.name = \"photo-\".concat(Date.now(), \".png\");\n\n        _this10.upload([blob]);\n      });\n    }\n  }, {\n    key: \"buildUpload\",\n    value: function buildUpload() {\n      var _this11 = this;\n\n      // Drop event must change this pointer so need a reference to parent this.\n      var element = this; // Declare Camera Instace\n\n      var Camera; // Implement Camera file upload for WebView Apps.\n\n      if (this.component.image && (navigator.camera || Camera)) {\n        var camera = navigator.camera || Camera;\n        return this.ce('div', {}, !this.disabled && (this.component.multiple || this.dataValue.length === 0) ? this.ce('div', {\n          class: 'fileSelector'\n        }, [this.ce('button', {\n          class: 'btn btn-primary',\n          onClick: function onClick(event) {\n            event.preventDefault();\n            camera.getPicture(function (success) {\n              window.resolveLocalFileSystemURL(success, function (fileEntry) {\n                fileEntry.file(function (file) {\n                  _this11.upload([file]);\n                });\n              });\n            }, null, {\n              sourceType: camera.PictureSourceType.PHOTOLIBRARY\n            });\n          }\n        }, [this.ce('i', {\n          class: this.iconClass('book')\n        }), this.text('Gallery')]), this.ce('button', {\n          class: 'btn btn-primary',\n          onClick: function onClick(event) {\n            event.preventDefault();\n            camera.getPicture(function (success) {\n              window.resolveLocalFileSystemURL(success, function (fileEntry) {\n                fileEntry.file(function (file) {\n                  _this11.upload([file]);\n                });\n              });\n            }, null, {\n              sourceType: camera.PictureSourceType.CAMERA,\n              encodingType: camera.EncodingType.PNG,\n              mediaType: camera.MediaType.PICTURE,\n              saveToPhotoAlbum: true,\n              correctOrientation: false\n            });\n          }\n        }, [this.ce('i', {\n          class: this.iconClass('camera')\n        }), this.text('Camera')])]) : this.ce('div'));\n      } // If this is disabled or a single value with a value, don't show the upload div.\n\n\n      var render = this.ce('div', {}, !this.disabled && (this.component.multiple || this.dataValue.length === 0) ? !this.cameraMode ? [this.ce('div', {\n        class: 'fileSelector',\n        onDragover: function onDragover(event) {\n          this.className = 'fileSelector fileDragOver';\n          event.preventDefault();\n        },\n        onDragleave: function onDragleave(event) {\n          this.className = 'fileSelector';\n          event.preventDefault();\n        },\n        onDrop: function onDrop(event) {\n          this.className = 'fileSelector';\n          event.preventDefault();\n          element.upload(event.dataTransfer.files);\n          return false;\n        }\n      }, [this.ce('i', {\n        class: this.iconClass('cloud-upload')\n      }), this.text(' '), this.text('Drop files to attach, or'), this.text(' '), this.buildBrowseLink(), this.component.webcam ? [this.text(', or'), this.text(' '), this.ce('a', {\n        href: '#',\n        title: 'Use Web Camera',\n        onClick: function onClick(event) {\n          event.preventDefault();\n          _this11.cameraMode = !_this11.cameraMode;\n\n          _this11.refreshDOM();\n        }\n      }, this.ce('i', {\n        class: this.iconClass('camera')\n      }))] : null])] : [this.ce('div', {}, [this.video = this.ce('video', {\n        class: 'video',\n        autoplay: true\n      }), this.canvas = this.ce('canvas', {\n        style: 'display: none;'\n      }), this.photo = this.ce('img')]), this.ce('div', {\n        class: 'btn btn-primary',\n        onClick: function onClick() {\n          _this11.takePicture();\n        }\n      }, 'Take Photo'), this.ce('div', {\n        class: 'btn btn-default',\n        onClick: function onClick() {\n          _this11.cameraMode = !_this11.cameraMode;\n\n          _this11.refreshDOM();\n        }\n      }, 'Switch to file upload')] : this.ce('div'));\n\n      if (this.cameraMode) {\n        this.startVideo();\n      }\n\n      return render;\n    }\n  }, {\n    key: \"buildBrowseLink\",\n    value: function buildBrowseLink() {\n      var _this12 = this;\n\n      this.browseLink = this.ce('a', {\n        href: '#',\n        onClick: function onClick(event) {\n          event.preventDefault(); // There is no direct way to trigger a file dialog. To work around this, create an input of type file and trigger\n          // a click event on it.\n\n          if (typeof _this12.hiddenFileInputElement.trigger === 'function') {\n            _this12.hiddenFileInputElement.trigger('click');\n          } else {\n            _this12.hiddenFileInputElement.click();\n          }\n        },\n        class: 'browse'\n      }, this.text('browse'));\n      this.addFocusBlurEvents(this.browseLink);\n      return this.browseLink;\n    }\n  }, {\n    key: \"buildUploadStatusList\",\n    value: function buildUploadStatusList(container) {\n      var list = this.ce('div');\n      this.uploadStatusList = list;\n      container.appendChild(list);\n    }\n  }, {\n    key: \"addWarnings\",\n    value: function addWarnings(container) {\n      var hasWarnings = false;\n      var warnings = this.ce('div', {\n        class: 'alert alert-warning'\n      });\n\n      if (!this.component.storage) {\n        hasWarnings = true;\n        warnings.appendChild(this.ce('p').appendChild(this.text('No storage has been set for this field. File uploads are disabled until storage is set up.')));\n      }\n\n      if (!this.support.dnd) {\n        hasWarnings = true;\n        warnings.appendChild(this.ce('p').appendChild(this.text('File Drag/Drop is not supported for this browser.')));\n      }\n\n      if (!this.support.filereader) {\n        hasWarnings = true;\n        warnings.appendChild(this.ce('p').appendChild(this.text('File API & FileReader API not supported.')));\n      }\n\n      if (!this.support.formdata) {\n        hasWarnings = true;\n        warnings.appendChild(this.ce('p').appendChild(this.text('XHR2\\'s FormData is not supported.')));\n      }\n\n      if (!this.support.progress) {\n        hasWarnings = true;\n        warnings.appendChild(this.ce('p').appendChild(this.text('XHR2\\'s upload progress isn\\'t supported.')));\n      }\n\n      if (hasWarnings) {\n        container.appendChild(warnings);\n      }\n    }\n    /* eslint-disable max-len */\n\n  }, {\n    key: \"fileSize\",\n    value: function fileSize(a, b, c, d, e) {\n      return \"\".concat((b = Math, c = b.log, d = 1024, e = c(a) / c(d) | 0, a / b.pow(d, e)).toFixed(2), \" \").concat(e ? \"\".concat('kMGTPEZY'[--e], \"B\") : 'Bytes');\n    }\n    /* eslint-enable max-len */\n\n  }, {\n    key: \"createUploadStatus\",\n    value: function createUploadStatus(fileUpload) {\n      var _this13 = this;\n\n      var container;\n      return container = this.ce('div', {\n        class: \"file\".concat(fileUpload.status === 'error' ? ' has-error' : '')\n      }, [this.ce('div', {\n        class: 'row'\n      }, [this.ce('div', {\n        class: 'fileName control-label col-sm-10'\n      }, [fileUpload.originalName, this.ce('i', {\n        class: this.iconClass('remove'),\n        onClick: function onClick() {\n          return _this13.removeChildFrom(container, _this13.uploadStatusList);\n        }\n      })]), this.ce('div', {\n        class: 'fileSize control-label col-sm-2 text-right'\n      }, this.fileSize(fileUpload.size))]), this.ce('div', {\n        class: 'row'\n      }, [this.ce('div', {\n        class: 'col-sm-12'\n      }, [fileUpload.status === 'progress' ? this.ce('div', {\n        class: 'progress'\n      }, this.ce('div', {\n        class: 'progress-bar',\n        role: 'progressbar',\n        'aria-valuenow': fileUpload.progress,\n        'aria-valuemin': 0,\n        'aria-valuemax': 100,\n        style: \"width:\".concat(fileUpload.progress, \"%\")\n      }, this.ce('span', {\n        class: 'sr-only'\n      }, \"\".concat(fileUpload.progress, \"% Complete\")))) : this.ce('div', {\n        class: \"bg-\".concat(fileUpload.status)\n      }, fileUpload.message)])])]);\n    }\n    /* eslint-disable max-depth */\n\n  }, {\n    key: \"globStringToRegex\",\n    value: function globStringToRegex(str) {\n      var regexp = '',\n          excludes = [];\n\n      if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\n        regexp = str.substring(1, str.length - 1);\n      } else {\n        var split = str.split(',');\n\n        if (split.length > 1) {\n          for (var i = 0; i < split.length; i++) {\n            var r = this.globStringToRegex(split[i]);\n\n            if (r.regexp) {\n              regexp += \"(\".concat(r.regexp, \")\");\n\n              if (i < split.length - 1) {\n                regexp += '|';\n              }\n            } else {\n              excludes = excludes.concat(r.excludes);\n            }\n          }\n        } else {\n          if (str.indexOf('!') === 0) {\n            excludes.push(\"^((?!\".concat(this.globStringToRegex(str.substring(1)).regexp, \").)*$\"));\n          } else {\n            if (str.indexOf('.') === 0) {\n              str = \"*\".concat(str);\n            }\n\n            regexp = \"^\".concat(str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\-]', 'g'), '\\\\$&'), \"$\");\n            regexp = regexp.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n          }\n        }\n      }\n\n      return {\n        regexp: regexp,\n        excludes: excludes\n      };\n    }\n    /* eslint-enable max-depth */\n\n  }, {\n    key: \"translateScalars\",\n    value: function translateScalars(str) {\n      if (typeof str === 'string') {\n        if (str.search(/kb/i) === str.length - 2) {\n          return parseFloat(str.substring(0, str.length - 2) * 1024);\n        } else if (str.search(/mb/i) === str.length - 2) {\n          return parseFloat(str.substring(0, str.length - 2) * 1048576);\n        } else if (str.search(/gb/i) === str.length - 2) {\n          return parseFloat(str.substring(0, str.length - 2) * 1073741824);\n        } else if (str.search(/b/i) === str.length - 1) {\n          return parseFloat(str.substring(0, str.length - 1));\n        } else if (str.search(/s/i) === str.length - 1) {\n          return parseFloat(str.substring(0, str.length - 1));\n        } else if (str.search(/m/i) === str.length - 1) {\n          return parseFloat(str.substring(0, str.length - 1) * 60);\n        } else if (str.search(/h/i) === str.length - 1) {\n          return parseFloat(str.substring(0, str.length - 1) * 3600);\n        }\n      }\n\n      return str;\n    }\n  }, {\n    key: \"validatePattern\",\n    value: function validatePattern(file, val) {\n      if (!val) {\n        return true;\n      }\n\n      var pattern = this.globStringToRegex(val);\n      var valid = true;\n\n      if (pattern.regexp && pattern.regexp.length) {\n        var regexp = new RegExp(pattern.regexp, 'i');\n        valid = file.type != null && regexp.test(file.type) || file.name != null && regexp.test(file.name);\n      }\n\n      var len = pattern.excludes.length;\n\n      while (len--) {\n        var exclude = new RegExp(pattern.excludes[len], 'i');\n        valid = valid && (file.type == null || exclude.test(file.type)) && (file.name == null || exclude.test(file.name));\n      }\n\n      return valid;\n    }\n  }, {\n    key: \"validateMinSize\",\n    value: function validateMinSize(file, val) {\n      return file.size + 0.1 >= this.translateScalars(val);\n    }\n  }, {\n    key: \"validateMaxSize\",\n    value: function validateMaxSize(file, val) {\n      return file.size - 0.1 <= this.translateScalars(val);\n    }\n  }, {\n    key: \"upload\",\n    value: function upload(files) {\n      var _this14 = this;\n\n      // Only allow one upload if not multiple.\n      if (!this.component.multiple) {\n        files = Array.prototype.slice.call(files, 0, 1);\n      }\n\n      if (this.component.storage && files && files.length) {\n        // files is not really an array and does not have a forEach method, so fake it.\n\n        /* eslint-disable max-statements */\n        Array.prototype.forEach.call(files, function (file) {\n          var fileName = (0, _utils.uniqueName)(file.name, _this14.component.fileNameTemplate, _this14.evalContext());\n          var fileUpload = {\n            originalName: file.name,\n            name: fileName,\n            size: file.size,\n            status: 'info',\n            message: 'Starting upload'\n          }; // Check file pattern\n\n          if (_this14.component.filePattern && !_this14.validatePattern(file, _this14.component.filePattern)) {\n            fileUpload.status = 'error';\n            fileUpload.message = \"File is the wrong type; it must be \".concat(_this14.component.filePattern);\n          } // Check file minimum size\n\n\n          if (_this14.component.fileMinSize && !_this14.validateMinSize(file, _this14.component.fileMinSize)) {\n            fileUpload.status = 'error';\n            fileUpload.message = \"File is too small; it must be at least \".concat(_this14.component.fileMinSize);\n          } // Check file maximum size\n\n\n          if (_this14.component.fileMaxSize && !_this14.validateMaxSize(file, _this14.component.fileMaxSize)) {\n            fileUpload.status = 'error';\n            fileUpload.message = \"File is too big; it must be at most \".concat(_this14.component.fileMaxSize);\n          } // Get a unique name for this file to keep file collisions from occurring.\n\n\n          var dir = _this14.interpolate(_this14.component.dir || '');\n\n          var fileService = _this14.fileService;\n\n          if (!fileService) {\n            fileUpload.status = 'error';\n            fileUpload.message = 'File Service not provided.';\n          }\n\n          var uploadStatus = _this14.createUploadStatus(fileUpload);\n\n          _this14.uploadStatusList.appendChild(uploadStatus);\n\n          if (fileUpload.status !== 'error') {\n            // Track uploads in progress.\n            if (fileService.uploadsInProgress === undefined) {\n              var cssClass = 'uploads-in-progress';\n\n              var submitComponent = _this14.root.element.querySelector('.formio-component-submit');\n\n              var submitButton = submitComponent ? submitComponent.querySelector('button') : null;\n              var array = new Array();\n              fileService.uploadsInProgress = {\n                array: array,\n                add: function add(item) {\n                  if (submitButton && cssClass && array.length === 0) {\n                    submitButton.classList.add(cssClass);\n                  }\n\n                  array.push(item);\n                },\n                remove: function remove(item) {\n                  array.splice(array.indexOf(item), 1);\n\n                  if (submitButton && cssClass && array.length === 0) {\n                    submitButton.classList.remove(cssClass);\n                  }\n                },\n                report: function report() {\n                  var n = array.length;\n                  var msg = \"Uploads in progress: \".concat(n);\n\n                  if (n > 0) {\n                    var keys = array.map(function (x) {\n                      return x.component.key;\n                    });\n                    msg += \" (\".concat(keys.join(', '), \")\");\n                  }\n\n                  console.log(msg);\n                }\n              };\n            }\n\n            var uploadsInProgress = fileService.uploadsInProgress;\n            uploadsInProgress.add(_this14); //uploadsInProgress.report();\n            //\n\n            if (_this14.component.privateDownload) {\n              file.private = true;\n            }\n\n            var _this14$component = _this14.component,\n                storage = _this14$component.storage,\n                url = _this14$component.url,\n                options = _this14$component.options;\n            fileService.uploadFile(storage, file, fileName, dir, function (evt) {\n              fileUpload.status = 'progress';\n              fileUpload.progress = parseInt(100.0 * evt.loaded / evt.total);\n              delete fileUpload.message;\n              var originalStatus = uploadStatus;\n              uploadStatus = _this14.createUploadStatus(fileUpload);\n\n              _this14.uploadStatusList.replaceChild(uploadStatus, originalStatus);\n            }, url, options).then(function (fileInfo) {\n              _this14.removeChildFrom(uploadStatus, _this14.uploadStatusList); // Default to first type.\n\n\n              if (_this14.hasTypes) {\n                fileInfo.fileType = _this14.component.fileTypes[0].value;\n              }\n\n              fileInfo.originalName = file.name;\n              var files = _this14.dataValue;\n\n              if (!files || !Array.isArray(files)) {\n                files = [];\n              }\n\n              files.push(fileInfo);\n\n              _this14.setValue(_this14.dataValue); // Track uploads in progress.\n\n\n              uploadsInProgress.remove(_this14); //uploadsInProgress.report();\n              //\n\n              _this14.triggerChange();\n            }).catch(function (response) {\n              fileUpload.status = 'error';\n              fileUpload.message = response;\n              delete fileUpload.progress;\n              var originalStatus = uploadStatus;\n              uploadStatus = _this14.createUploadStatus(fileUpload);\n\n              _this14.uploadStatusList.replaceChild(uploadStatus, originalStatus);\n            });\n          }\n        });\n        /* eslint-enable max-statements */\n      }\n    }\n  }, {\n    key: \"getFile\",\n    value: function getFile(fileInfo, event) {\n      var fileService = this.fileService;\n\n      if (!fileService) {\n        return alert('File Service not provided');\n      }\n\n      if (this.component.privateDownload) {\n        fileInfo.private = true;\n      }\n\n      fileService.downloadFile(fileInfo).then(function (file) {\n        if (file) {\n          if (file.storage === 'base64') {\n            (0, _downloadjs.default)(file.url, file.originalName, file.type);\n          } else {\n            window.open(file.url, '_blank');\n          }\n        }\n      }).catch(function (response) {\n        // Is alert the best way to do this?\n        // User is expecting an immediate notification due to attempting to download a file.\n        alert(response);\n      });\n      event.preventDefault();\n    }\n  }, {\n    key: \"focus\",\n    value: function focus() {\n      this.browseLink.focus();\n    }\n  }, {\n    key: \"dataReady\",\n    get: function get() {\n      return this.filesReady;\n    }\n  }, {\n    key: \"defaultSchema\",\n    get: function get() {\n      return FileComponent.schema();\n    }\n  }, {\n    key: \"emptyValue\",\n    get: function get() {\n      return [];\n    }\n  }, {\n    key: \"defaultValue\",\n    get: function get() {\n      var value = _get(_getPrototypeOf(FileComponent.prototype), \"defaultValue\", this);\n\n      if (_lodash.default.isEqual(value, []) && this.options.flatten) {\n        return [{\n          storage: '',\n          name: '',\n          size: 0,\n          type: '',\n          originalName: ''\n        }];\n      }\n\n      return Array.isArray(value) ? value : [];\n    }\n  }, {\n    key: \"hasTypes\",\n    get: function get() {\n      return this.component.fileTypes && Array.isArray(this.component.fileTypes) && this.component.fileTypes.length !== 0 && (this.component.fileTypes[0].label !== '' || this.component.fileTypes[0].value !== '');\n    }\n  }, {\n    key: \"fileService\",\n    get: function get() {\n      if (this.options.fileService) {\n        return this.options.fileService;\n      }\n\n      if (this.options.formio) {\n        return this.options.formio;\n      }\n\n      if (this.root && this.root.formio) {\n        return this.root.formio;\n      }\n\n      var formio = new _Formio.default(); // If a form is loaded, then make sure to set the correct formUrl.\n\n      if (this.root && this.root._form && this.root._form._id) {\n        formio.formUrl = \"\".concat(formio.projectUrl, \"/form/\").concat(this.root._form._id);\n      }\n\n      return formio;\n    }\n  }]);\n\n  return FileComponent;\n}(_Base.default);\n\nexports.default = FileComponent;",null]}