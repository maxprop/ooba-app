/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Inject, PLATFORM_ID, VERSION as AngularVersion, } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import * as algoliasearchProxy from 'algoliasearch/lite';
import instantsearch from 'instantsearch.js/es';
import { VERSION } from '../version';
/** @type {?} */
const algoliasearch = algoliasearchProxy.default || algoliasearchProxy;
/**
 * @record
 */
export function SearchRequestParameters() { }
if (false) {
    /** @type {?} */
    SearchRequestParameters.prototype.query;
}
/**
 * @record
 */
export function SearchForFacetValuesRequestParameters() { }
if (false) {
    /** @type {?} */
    SearchForFacetValuesRequestParameters.prototype.facetQuery;
    /** @type {?} */
    SearchForFacetValuesRequestParameters.prototype.facetName;
}
export class InstantSearchInstance {
}
if (false) {
    /** @type {?} */
    InstantSearchInstance.prototype.start;
    /** @type {?} */
    InstantSearchInstance.prototype.addWidget;
    /** @type {?} */
    InstantSearchInstance.prototype.addWidgets;
    /** @type {?} */
    InstantSearchInstance.prototype.removeWidget;
    /** @type {?} */
    InstantSearchInstance.prototype.removeWidgets;
    /** @type {?} */
    InstantSearchInstance.prototype.on;
    /** @type {?} */
    InstantSearchInstance.prototype.removeListener;
    /** @type {?} */
    InstantSearchInstance.prototype.helper;
    /** @type {?} */
    InstantSearchInstance.prototype.refresh;
    /** @type {?} */
    InstantSearchInstance.prototype.dispose;
}
export class NgAisInstantSearch {
    /**
     * @param {?} platformId
     */
    constructor(platformId) {
        this.platformId = platformId;
        this.instanceName = 'default';
        this.change = new EventEmitter();
        this.onRender = () => {
            this.change.emit({
                results: this.instantSearchInstance.helper.lastResults,
                state: this.instantSearchInstance.helper.state,
            });
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.createInstantSearchInstance(this.config);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.instantSearchInstance.start();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.instantSearchInstance.removeListener('render', this.onRender);
        this.instantSearchInstance.dispose();
    }
    /**
     * @param {?} config
     * @return {?}
     */
    createInstantSearchInstance(config) {
        // add default searchParameters with highlighting config
        if (!config.searchParameters)
            config.searchParameters = {};
        Object.assign(config.searchParameters, {
            highlightPreTag: '__ais-highlight__',
            highlightPostTag: '__/ais-highlight__',
        });
        // remove URLSync widget if on SSR
        if (!isPlatformBrowser(this.platformId)) {
            if (typeof config.urlSync !== 'undefined')
                delete config.urlSync;
            if (typeof config.routing !== 'undefined')
                delete config.routing;
        }
        if (!config.searchClient && !config.createAlgoliaClient) {
            /** @type {?} */
            const client = algoliasearch(config.appId, config.apiKey);
            config.searchClient = client;
            config.appId = undefined;
            config.apiKey = undefined;
        }
        // custom algolia client agent
        if (typeof config.searchClient.addAlgoliaAgent === 'function') {
            // add user agents
            config.searchClient.addAlgoliaAgent(`angular (${AngularVersion.full})`);
            config.searchClient.addAlgoliaAgent(`angular-instantsearch (${VERSION})`);
        }
        this.instantSearchInstance = instantsearch(config);
        this.instantSearchInstance.on('render', this.onRender);
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    addWidget(widget) {
        this.instantSearchInstance.addWidget(widget);
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    removeWidget(widget) {
        this.instantSearchInstance.removeWidget(widget);
    }
    /**
     * @return {?}
     */
    refresh() {
        this.instantSearchInstance.refresh();
    }
}
NgAisInstantSearch.decorators = [
    { type: Component, args: [{
                selector: 'ais-instantsearch',
                template: `<ng-content></ng-content>`,
            },] },
];
/** @nocollapse */
NgAisInstantSearch.ctorParameters = () => [
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
NgAisInstantSearch.propDecorators = {
    config: [{ type: Input }],
    instanceName: [{ type: Input }],
    change: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    NgAisInstantSearch.prototype.config;
    /** @type {?} */
    NgAisInstantSearch.prototype.instanceName;
    /** @type {?} */
    NgAisInstantSearch.prototype.change;
    /** @type {?} */
    NgAisInstantSearch.prototype.instantSearchInstance;
    /** @type {?} */
    NgAisInstantSearch.prototype.onRender;
    /**
     * @type {?}
     * @private
     */
    NgAisInstantSearch.prototype.platformId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zdGFudHNlYXJjaC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItaW5zdGFudHNlYXJjaC8iLCJzb3VyY2VzIjpbImluc3RhbnRzZWFyY2gvaW5zdGFudHNlYXJjaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxLQUFLLEVBR0wsTUFBTSxFQUNOLFlBQVksRUFDWixNQUFNLEVBQ04sV0FBVyxFQUNYLE9BQU8sSUFBSSxjQUFjLEdBQzFCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXBELE9BQU8sS0FBSyxrQkFBa0IsTUFBTSxvQkFBb0IsQ0FBQztBQUN6RCxPQUFPLGFBQWEsTUFBTSxxQkFBcUIsQ0FBQztBQUloRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDOztNQUUvQixhQUFhLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxJQUFJLGtCQUFrQjs7OztBQTBGdEUsNkNBRUM7OztJQURDLHdDQUFjOzs7OztBQUdoQiwyREFJQzs7O0lBRkMsMkRBQW1COztJQUNuQiwwREFBa0I7O0FBOEVwQixNQUFNLE9BQU8scUJBQXFCO0NBb0JqQzs7O0lBbkJDLHNDQUF5Qjs7SUFFekIsMENBQTJDOztJQUMzQywyQ0FBK0M7O0lBRS9DLDZDQUE4Qzs7SUFDOUMsOENBQWtEOztJQUdsRCxtQ0FBMkQ7O0lBQzNELCtDQUF1RTs7SUFFdkUsdUNBR0U7O0lBRUYsd0NBQTJCOztJQUMzQix3Q0FBMkI7O0FBTzdCLE1BQU0sT0FBTyxrQkFBa0I7Ozs7SUFZN0IsWUFBeUMsVUFBa0I7UUFBbEIsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQVYzQyxpQkFBWSxHQUFXLFNBQVMsQ0FBQztRQUdqRCxXQUFNLEdBQTZDLElBQUksWUFBWSxFQUcvRCxDQUFDO1FBOERMLGFBQVEsR0FBRyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsTUFBTSxDQUFD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QWFzRCxNQUFNLHVCQUE5QyxNQUFNLFNBQUMsV0FBVzs7O3FCQVg5QixLQUFLOzJCQUNMLEtBQUs7cUJBRUwsTUFBTTs7OztJQUhQLG9DQUE0Qzs7SUFDNUMsMENBQWlEOztJQUVqRCxvQ0FJSzs7SUFFTCxtREFBb0Q7O0lBNERwRCxzQ0FLRTs7Ozs7SUEvRFUsd0NBQStDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3QsXG4gIFBMQVRGT1JNX0lELFxuICBWRVJTSU9OIGFzIEFuZ3VsYXJWZXJzaW9uLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuaW1wb3J0ICogYXMgYWxnb2xpYXNlYXJjaFByb3h5IGZyb20gJ2FsZ29saWFzZWFyY2gvbGl0ZSc7XG5pbXBvcnQgaW5zdGFudHNlYXJjaCBmcm9tICdpbnN0YW50c2VhcmNoLmpzL2VzJztcbmltcG9ydCB7IEFsZ29saWFTZWFyY2hIZWxwZXIgfSBmcm9tICdhbGdvbGlhc2VhcmNoLWhlbHBlcic7XG5cbmltcG9ydCB7IFdpZGdldCB9IGZyb20gJy4uL2Jhc2Utd2lkZ2V0JztcbmltcG9ydCB7IFZFUlNJT04gfSBmcm9tICcuLi92ZXJzaW9uJztcblxuY29uc3QgYWxnb2xpYXNlYXJjaCA9IGFsZ29saWFzZWFyY2hQcm94eS5kZWZhdWx0IHx8IGFsZ29saWFzZWFyY2hQcm94eTtcblxuZXhwb3J0IHR5cGUgU2VhcmNoUmVxdWVzdCA9IHtcbiAgaW5kZXhOYW1lOiBzdHJpbmc7XG4gIHBhcmFtczogU2VhcmNoUmVxdWVzdFBhcmFtZXRlcnM7XG59O1xuXG5leHBvcnQgdHlwZSBTZWFyY2hGb3JGYWNldFZhbHVlc1JlcXVlc3QgPSB7XG4gIGluZGV4TmFtZTogc3RyaW5nO1xuICBwYXJhbXM6IFNlYXJjaEZvckZhY2V0VmFsdWVzUmVxdWVzdFBhcmFtZXRlcnM7XG59O1xuXG4vLyBEb2N1bWVudGF0aW9uOiBodHRwczovL3d3dy5hbGdvbGlhLmNvbS9kb2MvYXBpLXJlZmVyZW5jZS9zZWFyY2gtYXBpLXBhcmFtZXRlcnMvXG5leHBvcnQgdHlwZSBTZWFyY2hQYXJhbWV0ZXJzID0ge1xuICAvLyBBdHRyaWJ1dGVzXG4gIGF0dHJpYnV0ZXNUb1JldHJpZXZlPzogc3RyaW5nW107XG4gIHJlc3RyaWN0U2VhcmNoYWJsZUF0dHJpYnV0ZXM/OiBzdHJpbmdbXTtcblxuICAvLyBGaWx0ZXJpbmdcbiAgZmlsdGVycz86IHN0cmluZztcbiAgZmFjZXRGaWx0ZXJzPzogc3RyaW5nW107XG4gIG9wdGlvbmFsRmlsdGVycz86IHN0cmluZ1tdO1xuICBudW1lcmljRmlsdGVycz86IHN0cmluZ1tdO1xuICBzdW1PckZpbHRlcnNTY29yZXM/OiBib29sZWFuO1xuXG4gIC8vIEZhY2V0aW5nXG4gIGZhY2V0cz86IHN0cmluZ1tdO1xuICBtYXhWYWx1ZXNQZXJGYWNldD86IG51bWJlcjtcbiAgZmFjZXRpbmdBZnRlckRpc3RpbmN0PzogYm9vbGVhbjtcbiAgc29ydEZhY2V0VmFsdWVzQnk/OiBzdHJpbmc7XG5cbiAgLy8gSGlnaGxpZ2h0aW5nIC8gU25pcHBldGluZ1xuICBhdHRyaWJ1dGVzVG9IaWdobGlnaHQ/OiBzdHJpbmdbXTtcbiAgYXR0cmlidXRlc1RvU25pcHBldD86IHN0cmluZ1tdO1xuICBoaWdobGlnaHRQcmVUYWc/OiBzdHJpbmc7XG4gIGhpZ2hsaWdodFBvc3RUYWc/OiBzdHJpbmc7XG4gIHNuaXBwZXRFbGxpcHNpc1RleHQ/OiBzdHJpbmc7XG4gIHJlc3RyaWN0SGlnaGxpZ2h0QW5kU25pcHBldEFycmF5cz86IGJvb2xlYW47XG5cbiAgLy8gUGFnaW5hdGlvblxuICBwYWdlPzogbnVtYmVyO1xuICBoaXRzUGVyUGFnZT86IG51bWJlcjtcbiAgb2Zmc2V0PzogbnVtYmVyO1xuICBsZW5ndGg/OiBudW1iZXI7XG5cbiAgLy8gVHlwb3NcbiAgbWluV29yZFNpemVmb3IxVHlwbz86IG51bWJlcjtcbiAgbWluV29yZFNpemVmb3IyVHlwb3M/OiBudW1iZXI7XG4gIHR5cG9Ub2xlcmFuY2U/OiBzdHJpbmcgfCBib29sZWFuO1xuICBhbGxvd1R5cG9zT25OdW1lcmljVG9rZW5zPzogYm9vbGVhbjtcbiAgaWdub3JlUGx1cmFscz86IGJvb2xlYW4gfCBzdHJpbmdbXTtcbiAgZGlzYWJsZVR5cG9Ub2xlcmFuY2VPbkF0dHJpYnV0ZXM/OiBzdHJpbmdbXTtcblxuICAvLyBHZW8tU2VhcmNoXG4gIGFyb3VuZExhdExuZz86IHN0cmluZztcbiAgYXJvdW5kTGF0TG5nVmlhSVA/OiBib29sZWFuO1xuICBhcm91bmRSYWRpdXM/OiBudW1iZXIgfCAnYWxsJztcbiAgYXJvdW5kUHJlY2lzaW9uPzogbnVtYmVyO1xuICBtaW5pbXVtQXJvdW5kUmFkaXVzPzogbnVtYmVyO1xuICBpbnNpZGVCb3VuZGluZ0JveD86IEdlb1JlY3RhbmdsZSB8IEdlb1JlY3RhbmdsZVtdO1xuICBpbnNpZGVQb2x5Z29uPzogR2VvUG9seWdvbiB8IEdlb1BvbHlnb25bXTtcblxuICAvLyBRdWVyeSBTdHJhdGVneVxuICBxdWVyeVR5cGU/OiBzdHJpbmc7XG4gIHJlbW92ZVdvcmRzSWZOb1Jlc3VsdHM/OiBzdHJpbmc7XG4gIGFkdmFuY2VkU3ludGF4PzogYm9vbGVhbjtcbiAgb3B0aW9uYWxXb3Jkcz86IHN0cmluZyB8IHN0cmluZ1tdO1xuICByZW1vdmVTdG9wV29yZHM/OiBib29sZWFuIHwgc3RyaW5nW107XG4gIGRpc2FibGVFeGFjdE9uQXR0cmlidXRlcz86IHN0cmluZ1tdO1xuICBleGFjdE9uU2luZ2xlV29yZFF1ZXJ5Pzogc3RyaW5nO1xuICBhbHRlcm5hdGl2ZXNBc0V4YWN0Pzogc3RyaW5nW107XG5cbiAgLy8gUXVlcnkgUnVsZXNcbiAgZW5hYmxlUnVsZXM/OiBib29sZWFuO1xuICBydWxlQ29udGV4dHM/OiBzdHJpbmdbXTtcblxuICAvLyBBZHZhbmNlZFxuICBtaW5Qcm94aW1pdHk/OiBudW1iZXI7XG4gIHJlc3BvbnNlRmllbGRzPzogc3RyaW5nW107XG4gIG1heEZhY2V0SGl0cz86IG51bWJlcjtcbiAgcGVyY2VudGlsZUNvbXB1dGF0aW9uPzogYm9vbGVhbjtcbiAgZGlzdGluY3Q/OiBudW1iZXIgfCBib29sZWFuO1xuICBnZXRSYW5raW5nSW5mbz86IGJvb2xlYW47XG4gIGNsaWNrQW5hbHl0aWNzPzogYm9vbGVhbjtcbiAgYW5hbHl0aWNzPzogYm9vbGVhbjtcbiAgYW5hbHl0aWNzVGFncz86IHN0cmluZ1tdO1xuICBzeW5vbnltcz86IGJvb2xlYW47XG4gIHJlcGxhY2VTeW5vbnltc0luSGlnaGxpZ2h0PzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoUmVxdWVzdFBhcmFtZXRlcnMgZXh0ZW5kcyBTZWFyY2hQYXJhbWV0ZXJzIHtcbiAgcXVlcnk6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hGb3JGYWNldFZhbHVlc1JlcXVlc3RQYXJhbWV0ZXJzXG4gIGV4dGVuZHMgU2VhcmNoUGFyYW1ldGVycyB7XG4gIGZhY2V0UXVlcnk6IHN0cmluZztcbiAgZmFjZXROYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEdlb1JlY3RhbmdsZSA9IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdO1xuZXhwb3J0IHR5cGUgR2VvUG9seWdvbiA9IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTtcblxuLy8gRG9jdW1lbnRhdGlvbjogaHR0cHM6Ly93d3cuYWxnb2xpYS5jb20vZG9jL3Jlc3QtYXBpL3NlYXJjaC8/bGFuZ3VhZ2U9amF2YXNjcmlwdCNzZWFyY2gtbXVsdGlwbGUtaW5kZXhlc1xuZXhwb3J0IHR5cGUgU2VhcmNoUmVzcG9uc2UgPSB7XG4gIGhpdHM6IEhpdFtdO1xuICBwYWdlPzogbnVtYmVyO1xuICBuYkhpdHM/OiBudW1iZXI7XG4gIG5iUGFnZXM/OiBudW1iZXI7XG4gIGhpdHNQZXJQYWdlPzogbnVtYmVyO1xuICBwcm9jZXNzaW5nVGltZU1TPzogbnVtYmVyO1xuICBxdWVyeT86IHN0cmluZztcbiAgcGFyYW1zPzogc3RyaW5nO1xuICBpbmRleD86IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIEhpdCA9IHtcbiAgX2hpZ2hsaWdodFJlc3VsdD86IG9iamVjdDtcbn07XG5cbi8vIERvY3VtZW50YXRpb246IGh0dHBzOi8vd3d3LmFsZ29saWEuY29tL2RvYy9yZXN0LWFwaS9zZWFyY2gvP2xhbmd1YWdlPWphdmFzY3JpcHQjc2VhcmNoLWZvci1mYWNldC12YWx1ZXNcbmV4cG9ydCB0eXBlIFNlYXJjaEZvckZhY2V0VmFsdWVzUmVzcG9uc2UgPSB7XG4gIHZhbHVlOiBzdHJpbmc7XG4gIGhpZ2hsaWdodGVkPzogc3RyaW5nO1xuICBjb3VudD86IG51bWJlcjtcbn07XG5cbmV4cG9ydCB0eXBlIFNlYXJjaENsaWVudCA9IHtcbiAgYWRkQWxnb2xpYUFnZW50PzogKGFnZW50OiBzdHJpbmcpID0+IHZvaWQ7XG4gIHNlYXJjaDogKHJlcXVlc3RzOiBTZWFyY2hSZXF1ZXN0W10pID0+IFByb21pc2U8eyByZXN1bHRzOiBTZWFyY2hSZXNwb25zZVtdIH0+O1xuICBzZWFyY2hGb3JGYWNldFZhbHVlcz86IChcbiAgICByZXF1ZXN0czogU2VhcmNoRm9yRmFjZXRWYWx1ZXNSZXF1ZXN0W11cbiAgKSA9PiBQcm9taXNlPHsgZmFjZXRIaXRzOiBTZWFyY2hGb3JGYWNldFZhbHVlc1Jlc3BvbnNlW10gfVtdPjtcbn07XG5cbmV4cG9ydCB0eXBlIEluc3RhbnRTZWFyY2hDb25maWcgPSB7XG4gIGFwcElkPzogc3RyaW5nO1xuICBhcGlLZXk/OiBzdHJpbmc7XG4gIGluZGV4TmFtZTogc3RyaW5nO1xuXG4gIG51bWJlckxvY2FsZT86IHN0cmluZztcbiAgc2VhcmNoRnVuY3Rpb24/OiAoaGVscGVyOiBBbGdvbGlhU2VhcmNoSGVscGVyKSA9PiB2b2lkO1xuICBjcmVhdGVBbGdvbGlhQ2xpZW50PzogKFxuICAgIGFsZ29saWFzZWFyY2g6IEZ1bmN0aW9uLFxuICAgIGFwcElkOiBzdHJpbmcsXG4gICAgYXBpS2V5OiBzdHJpbmdcbiAgKSA9PiBvYmplY3Q7XG4gIHNlYXJjaENsaWVudD86IFNlYXJjaENsaWVudDtcbiAgc2VhcmNoUGFyYW1ldGVycz86IFNlYXJjaFBhcmFtZXRlcnMgfCB2b2lkO1xuICB1cmxTeW5jPzpcbiAgICB8IGJvb2xlYW5cbiAgICB8IHtcbiAgICAgICAgbWFwcGluZz86IG9iamVjdDtcbiAgICAgICAgdGhyZXNob2xkPzogbnVtYmVyO1xuICAgICAgICB0cmFja2VkUGFyYW1ldGVycz86IHN0cmluZ1tdO1xuICAgICAgICB1c2VIYXNoPzogYm9vbGVhbjtcbiAgICAgICAgZ2V0SGlzdG9yeVN0YXRlPzogKCkgPT4gb2JqZWN0O1xuICAgICAgfTtcbiAgcm91dGluZz86XG4gICAgfCBib29sZWFuXG4gICAgfCB7XG4gICAgICAgIHJvdXRlcj86IHtcbiAgICAgICAgICBvblVwZGF0ZTogKGNiOiAob2JqZWN0KSA9PiB2b2lkKSA9PiB2b2lkO1xuICAgICAgICAgIHJlYWQ6ICgpID0+IG9iamVjdDtcbiAgICAgICAgICB3cml0ZTogKHJvdXRlU3RhdGU6IG9iamVjdCkgPT4gdm9pZDtcbiAgICAgICAgICBjcmVhdGVVUkw6IChyb3V0ZVN0YXRlOiBvYmplY3QpID0+IHN0cmluZztcbiAgICAgICAgICBkaXNwb3NlOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBzdGF0ZU1hcHBpbmc/OiB7XG4gICAgICAgICAgc3RhdGVUb1JvdXRlKG9iamVjdCk6IG9iamVjdDtcbiAgICAgICAgICByb3V0ZVRvU3RhdGUob2JqZWN0KTogb2JqZWN0O1xuICAgICAgICB9O1xuICAgICAgfTtcbn07XG5cbmV4cG9ydCBjbGFzcyBJbnN0YW50U2VhcmNoSW5zdGFuY2Uge1xuICBwdWJsaWMgc3RhcnQ6ICgpID0+IHZvaWQ7XG5cbiAgcHVibGljIGFkZFdpZGdldDogKHdpZGdldDogV2lkZ2V0KSA9PiB2b2lkO1xuICBwdWJsaWMgYWRkV2lkZ2V0czogKHdpZGdldHM6IFdpZGdldFtdKSA9PiB2b2lkO1xuXG4gIHB1YmxpYyByZW1vdmVXaWRnZXQ6ICh3aWRnZXQ6IFdpZGdldCkgPT4gdm9pZDtcbiAgcHVibGljIHJlbW92ZVdpZGdldHM6ICh3aWRnZXRzOiBXaWRnZXRbXSkgPT4gdm9pZDtcblxuICAvLyBFdmVudEVtbWl0ZXJcbiAgcHVibGljIG9uOiAoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikgPT4gdm9pZDtcbiAgcHVibGljIHJlbW92ZUxpc3RlbmVyOiAoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikgPT4gdm9pZDtcblxuICBwdWJsaWMgaGVscGVyOiB7XG4gICAgbGFzdFJlc3VsdHM6IE9iamVjdDtcbiAgICBzdGF0ZTogT2JqZWN0O1xuICB9O1xuXG4gIHB1YmxpYyByZWZyZXNoOiAoKSA9PiB2b2lkO1xuICBwdWJsaWMgZGlzcG9zZTogKCkgPT4gdm9pZDtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYWlzLWluc3RhbnRzZWFyY2gnLFxuICB0ZW1wbGF0ZTogYDxuZy1jb250ZW50PjwvbmctY29udGVudD5gLFxufSlcbmV4cG9ydCBjbGFzcyBOZ0Fpc0luc3RhbnRTZWFyY2ggaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkluaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpIHB1YmxpYyBjb25maWc6IEluc3RhbnRTZWFyY2hDb25maWc7XG4gIEBJbnB1dCgpIHB1YmxpYyBpbnN0YW5jZU5hbWU6IHN0cmluZyA9ICdkZWZhdWx0JztcblxuICBAT3V0cHV0KClcbiAgY2hhbmdlOiBFdmVudEVtaXR0ZXI8eyByZXN1bHRzOiB7fTsgc3RhdGU6IHt9IH0+ID0gbmV3IEV2ZW50RW1pdHRlcjx7XG4gICAgcmVzdWx0czoge307XG4gICAgc3RhdGU6IHt9O1xuICB9PigpO1xuXG4gIHB1YmxpYyBpbnN0YW50U2VhcmNoSW5zdGFuY2U6IEluc3RhbnRTZWFyY2hJbnN0YW5jZTtcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCkge31cblxuICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jcmVhdGVJbnN0YW50U2VhcmNoSW5zdGFuY2UodGhpcy5jb25maWcpO1xuICB9XG5cbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5zdGFydCgpO1xuICB9XG5cbiAgcHVibGljIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLnJlbW92ZUxpc3RlbmVyKCdyZW5kZXInLCB0aGlzLm9uUmVuZGVyKTtcbiAgICB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5kaXNwb3NlKCk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlSW5zdGFudFNlYXJjaEluc3RhbmNlKGNvbmZpZzogSW5zdGFudFNlYXJjaENvbmZpZykge1xuICAgIC8vIGFkZCBkZWZhdWx0IHNlYXJjaFBhcmFtZXRlcnMgd2l0aCBoaWdobGlnaHRpbmcgY29uZmlnXG4gICAgaWYgKCFjb25maWcuc2VhcmNoUGFyYW1ldGVycykgY29uZmlnLnNlYXJjaFBhcmFtZXRlcnMgPSB7fTtcbiAgICBPYmplY3QuYXNzaWduKGNvbmZpZy5zZWFyY2hQYXJhbWV0ZXJzLCB7XG4gICAgICBoaWdobGlnaHRQcmVUYWc6ICdfX2Fpcy1oaWdobGlnaHRfXycsXG4gICAgICBoaWdobGlnaHRQb3N0VGFnOiAnX18vYWlzLWhpZ2hsaWdodF9fJyxcbiAgICB9KTtcblxuICAgIC8vIHJlbW92ZSBVUkxTeW5jIHdpZGdldCBpZiBvbiBTU1JcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm1JZCkpIHtcbiAgICAgIGlmICh0eXBlb2YgY29uZmlnLnVybFN5bmMgIT09ICd1bmRlZmluZWQnKSBkZWxldGUgY29uZmlnLnVybFN5bmM7XG4gICAgICBpZiAodHlwZW9mIGNvbmZpZy5yb3V0aW5nICE9PSAndW5kZWZpbmVkJykgZGVsZXRlIGNvbmZpZy5yb3V0aW5nO1xuICAgIH1cblxuICAgIGlmICghY29uZmlnLnNlYXJjaENsaWVudCAmJiAhY29uZmlnLmNyZWF0ZUFsZ29saWFDbGllbnQpIHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGFsZ29saWFzZWFyY2goY29uZmlnLmFwcElkLCBjb25maWcuYXBpS2V5KTtcbiAgICAgIGNvbmZpZy5zZWFyY2hDbGllbnQgPSBjbGllbnQ7XG4gICAgICBjb25maWcuYXBwSWQgPSB1bmRlZmluZWQ7XG4gICAgICBjb25maWcuYXBpS2V5ID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIGN1c3RvbSBhbGdvbGlhIGNsaWVudCBhZ2VudFxuICAgIGlmICh0eXBlb2YgY29uZmlnLnNlYXJjaENsaWVudC5hZGRBbGdvbGlhQWdlbnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIC8vIGFkZCB1c2VyIGFnZW50c1xuICAgICAgY29uZmlnLnNlYXJjaENsaWVudC5hZGRBbGdvbGlhQWdlbnQoYGFuZ3VsYXIgKCR7QW5ndWxhclZlcnNpb24uZnVsbH0pYCk7XG4gICAgICBjb25maWcuc2VhcmNoQ2xpZW50LmFkZEFsZ29saWFBZ2VudChgYW5ndWxhci1pbnN0YW50c2VhcmNoICgke1ZFUlNJT059KWApO1xuICAgIH1cbiAgICB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZSA9IGluc3RhbnRzZWFyY2goY29uZmlnKTtcbiAgICB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5vbigncmVuZGVyJywgdGhpcy5vblJlbmRlcik7XG4gIH1cblxuICBwdWJsaWMgYWRkV2lkZ2V0KHdpZGdldDogV2lkZ2V0KSB7XG4gICAgdGhpcy5pbnN0YW50U2VhcmNoSW5zdGFuY2UuYWRkV2lkZ2V0KHdpZGdldCk7XG4gIH1cblxuICBwdWJsaWMgcmVtb3ZlV2lkZ2V0KHdpZGdldDogV2lkZ2V0KSB7XG4gICAgdGhpcy5pbnN0YW50U2VhcmNoSW5zdGFuY2UucmVtb3ZlV2lkZ2V0KHdpZGdldCk7XG4gIH1cblxuICBwdWJsaWMgcmVmcmVzaCgpIHtcbiAgICB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5yZWZyZXNoKCk7XG4gIH1cblxuICBvblJlbmRlciA9ICgpID0+IHtcbiAgICB0aGlzLmNoYW5nZS5lbWl0KHtcbiAgICAgIHJlc3VsdHM6IHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLmhlbHBlci5sYXN0UmVzdWx0cyxcbiAgICAgIHN0YXRlOiB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5oZWxwZXIuc3RhdGUsXG4gICAgfSk7XG4gIH07XG59XG4iXX0=